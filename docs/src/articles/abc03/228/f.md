---
title: "ABC #228 F"
url: https://atcoder.jp/contests/abc228/tasks/abc228_f
---
$h_2 \gt h_1$ であっても意味はないので, $h_2 \gt h_1$ のときは $h_2 = h_1$ とする. $w_2$ も同様である.

二次元累積和を計算しておき, 指定の範囲の和を高速に求められるようにしておく. そしてこれを使って青木君がスタンプの左上を $(i, j)$ としたときのスタンプ内の数値の和を計算しておく.

今, 高橋君が左上を $(i, j)$ としてスタンプを押したとする. このとき青木君が押すスタンプの左上は $(i, j)$ から $(i+h_1-h_2, j+w_1-w_2)$ の範囲のどこかである. このうち最大となる数を求める.

次に高橋君が左上を $(i+1, j)$ としてスタンプを押したとき, 青木君が押すスタンプの左上は $(i+1, j)$ から $(i+h_1-h_2+1, j+w_1-w_2)$ の範囲のどこかである. これは上記の結果を用いてスライド最大値の要領で求めることができる. なお, 横方向の最大値はセグメントツリーに乗せておいて取得する.
